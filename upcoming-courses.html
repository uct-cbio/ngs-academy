---
layout: default
title: Upcoming Courses & Events
permalink: /courses/upcoming-courses/
---

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<div class="table-responsive">
<table id="abiEventsTable" class="display stripe hover" style="width:100%">
<thead>
<tr>
  <th>Title</th>
  <th>Organizer</th>
  <th>Start Date</th>
  <th>End Date</th>
</tr>
</thead>
<tbody id="eventsBody">

  <!-- ===================== -->
  <!-- JEKYLL EVENTS FILTER -->
  <!-- ===================== -->

  {% assign today = "now" | date: "%Y-%m-%d" %}
  {% assign sorted_posts = site.posts | where: "category", "upcoming" %}

  {% for post in sorted_posts %}
    {% assign post_end = post.end_date | date: "%Y-%m-%d" %}
    {% if post_end >= today %}
    <tr>
      <td data-order="{{ post.title }}">
        <a href="{{ post.link }}" target="_blank" rel="noopener noreferrer">
          {{ post.title }}
        </a>
        <br>
        <small>Posted: {{ post.posted_date | date_to_string }}</small>
      </td>
      <td>{{ post.training_provider }}</td>
      <td data-order="{{ post.start_date | date: '%Y-%m-%d' }}">
        {{ post.start_date | date: "%a, %b %d %Y" }}
      </td>
      <td data-order="{{ post.end_date | date: '%Y-%m-%d' }}">
        {{ post.end_date | date: "%a, %b %d %Y" }}
      </td>
    </tr>
    {% endif %}
  {% endfor %}

</tbody>
</table>
</div>

<script>
const abiEventsUrl = "https://www.bioinformaticsinstitute.africa/events";

const corsProxies = [
  { url: "https://corsproxy.io/?", parse: r => r.text() },
  { url: "https://api.allorigins.win/get?url=", parse: r => r.json().then(w => w.contents) },
  { url: "https://api.codetabs.com/v1/proxy?quest=", parse: r => r.text() }
];

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function initDataTable() {
  if ($.fn.DataTable.isDataTable('#abiEventsTable')) {
    $('#abiEventsTable').DataTable().destroy();
  }

  $("#abiEventsTable").DataTable({
    pageLength: 10,
    order: [[2, "asc"]],
    responsive: true
  });
}

function parseEventsFromHtml(html) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(html, "text/html");
  const rows = doc.querySelectorAll("table.views-view-table tbody tr");
  const events = [];

  rows.forEach(row => {
    const cells = row.querySelectorAll("td");
    if (cells.length < 2) return;

    const linkEl = cells[0].querySelector("a");
    const title = linkEl ? linkEl.textContent.trim() : cells[0].textContent.trim();
    const href = linkEl ? linkEl.getAttribute("href") : "#";
    const fullUrl = href.startsWith("http")
      ? href
      : "https://www.bioinformaticsinstitute.africa" + href;

    const dateText = cells[1].textContent.trim();
    let startDate = dateText;
    let endDate = "";

    if (dateText.includes(" - ")) {
      const parts = dateText.split(" - ");
      startDate = parts[0].trim();
      endDate = parts[1].trim();
    }

    events.push({ title, url: fullUrl, startDate, endDate });
  });

  return events;
}

function appendAbiRows(events) {
  const tbody = document.getElementById("eventsBody");

  const today = new Date();
  today.setHours(0,0,0,0);

  events.forEach(event => {

    const eventEnd = new Date(event.endDate);
    eventEnd.setHours(0,0,0,0);

    // Skip past events
    if (eventEnd < today) return;

    const row = `
      <tr>
        <td>
          <a href="${escapeHtml(event.url)}" target="_blank" rel="noopener noreferrer">
            ${escapeHtml(event.title)}
          </a>
        </td>
        <td>ABI</td>
        <td data-order="${new Date(event.startDate).toISOString()}">
          ${escapeHtml(event.startDate)}
        </td>
        <td data-order="${new Date(event.endDate).toISOString()}">
          ${escapeHtml(event.endDate)}
        </td>
      </tr>
    `;

    tbody.insertAdjacentHTML("beforeend", row);
  });
}

async function fetchWithFallback() {
  for (const proxy of corsProxies) {
    try {
      const response = await fetch(proxy.url + encodeURIComponent(abiEventsUrl));
      if (!response.ok) continue;

      const html = await proxy.parse(response);
      const events = parseEventsFromHtml(html);
      return events;
    } catch (err) {
      console.warn("Proxy failed:", proxy.url);
    }
  }
  return [];
}

fetchWithFallback()
  .then(events => {
    if (events.length > 0) {
      appendAbiRows(events);
    }
    initDataTable();
  })
  .catch(() => {
    initDataTable();
  });
</script>
