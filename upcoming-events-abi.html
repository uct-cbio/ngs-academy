---
layout: default
title: ABI Upcoming Events
permalink: /abi-events/
---
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<div class="table-responsive">
  <table id="abiEventsTable" class="display stripe hover" style="width:100%">
    <thead>
      <tr>
        <th>Title</th>
        <th>Organizer</th>
        <th>Start Date</th>
        <th>End Date</th>
      </tr>
    </thead>
    <tbody id="eventsBody">
      <tr>
        <td colspan="4" style="text-align:center;">Loading events...</td>
      </tr>
    </tbody>
  </table>
</div>
<script>
  // ==========================================
  // Fetch ABI Upcoming Events â†’ Format into DataTable
  // ==========================================
  const corsProxy = "https://api.allorigins.win/get?url=";
  const abiApi = encodeURIComponent("https://bioinformaticsinstitute.africa/get_upcoming_training");

  // Helper function to escape HTML to prevent XSS
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  fetch(`${corsProxy}${abiApi}`)
    .then(response => {
      if (!response.ok) throw new Error("Network error");
      return response.json();
    })
    .then(wrapper => {
      let rawData;
      try {
        rawData = JSON.parse(wrapper.contents);
      } catch (err) {
        throw new Error("Invalid JSON from API");
      }
      const data = Array.isArray(rawData)
        ? rawData
        : Array.isArray(rawData.data)
          ? rawData.data
          : [];
      const tbody = document.getElementById("eventsBody");
      tbody.innerHTML = "";
      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No upcoming events found.</td></tr>`;
        return;
      }
      data.forEach(event => {
        const title = escapeHtml(event.training_title || "Untitled Event");
        const org = escapeHtml(event.organizer || "Unknown");
        const start = escapeHtml(event.start_date || "TBA");
        const end = escapeHtml(event.end_date || "TBA");
        const url = event.training_url || "#";
        const row = `
          <tr>
            <td><a href="${escapeHtml(url)}" target="_blank" rel="noopener noreferrer">${title}</a></td>
            <td>${org}</td>
            <td>${start}</td>
            <td>${end}</td>
          </tr>
        `;
        tbody.insertAdjacentHTML("beforeend", row);
      });
      // Initialize DataTable AFTER data is loaded
      // Check if already initialized to prevent errors
      if ($.fn.DataTable.isDataTable('#abiEventsTable')) {
        $('#abiEventsTable').DataTable().destroy();
      }
      $("#abiEventsTable").DataTable({
        pageLength: 10,
        order: [[2, "asc"]], // sort by start date
        responsive: true
      });
    })
    .catch(err => {
      console.error("Fetch error:", err);
      document.getElementById("eventsBody").innerHTML = `
        <tr><td colspan="4" style="text-align:center;">Failed to load events.</td></tr>
      `;
    });
</script>